---
- name: Ensure old container is stopped
  docker_container:
    name: node-app
    state: absent
    force_kill: yes

- name: Build Docker image
  docker_image:
    path: /home/ec2-user/my-node-app
    name: node-app
    state: present

- name: Run Docker container
  docker_container:
    name: node-app
    image: node-app
    state: started
    restart_policy: always
    ports:
      - "80:3000"
    env_file: /home/ec2-user/my-node-app/.env

